<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="styles/main.css">

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="/admin_js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.10.2/typeahead.bundle.min.js"></script>
  </head>

  <script type="text/javascript">
  </script>


  <body>
    <div class="container-fluid">
      <div class="box">
        <div class="row header-row">
          <div id="header">
            <ul class="nav nav-pills pull-right nav-container">
            </ul>
            <h3 class="logo">CoursePlanner Admin</h3>
          </div>
        </div>
      </div>
    </div>

    <div id="course-list" style="position:absolute;left:30px;top:70px">
      <input id="course-search-box" class="typeahead" type="text" placeholder="Input Course Name">
      <button class="btn btn-primary" data-toggle="modal" data-target="#viewCourseModal" onclick="modifyCourseViewModal()">
        View
      </button>
      <button class="btn btn-primary" data-toggle="modal" data-target="#createCourseModal" onclick="modifyCourseCreateModal()">
        Create
      </button>
      <button class="btn btn-primary" data-toggle="modal" data-target="#deleteCourseModal" onclick="modifyCourseDeleteModal()">
        Delete
      </button>
    </div>

    <div class="modal fade" id="viewCourseModal" tabindex="-1" role="dialog" aria-labelledby="viewCourseModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="viewCourseModalLabel">Place Holder</h4>
          </div>
          <div id="view-modal-body" class="modal-body">
            <textarea id="viewCourseTextAreaID" rows="20" cols="80">Please wait while we fetch the json string...!</textarea>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="createCourseModal" tabindex="-1" role="dialog" aria-labelledby="createCourseModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="createCourseModalLabel"> Place Holder </h4>
          </div>
          <div class="modal-body">
            <textarea id="createCourseTextAreaID" rows="20" cols="80"></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="createCourse()">Create</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="deleteCourseModal" tabindex="-1" role="dialog" aria-labelledby="deleteCourseModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="deleteCourseModalLabel">Modal title</h4>
          </div>
          <div class="modal-body">
            Are you sure you want to delete this course?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="deleteCourse()">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <div id="program-sheet" style="position:absolute;left:30px;top:250px">
      <input id="program-sheet-search-box" class="typeahead" type="text" placeholder="Input Program Sheet">
      <button class="btn btn-primary" data-toggle="modal" data-target="#viewModal" onclick="modifyViewModal()">
        View
      </button>
      <button class="btn btn-primary" data-toggle="modal" data-target="#createModal" onclick="modifyCreateModal()">
        Create
      </button>
      <button class="btn btn-primary" data-toggle="modal" data-target="#deleteModal" onclick="modifyDeleteModal()">
        Delete
      </button>
    </div>

    <div class="modal fade" id="viewModal" tabindex="-1" role="dialog" aria-labelledby="viewModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="viewModalLabel">Place Holder</h4>
          </div>
          <div id="view-modal-body" class="modal-body">
            <textarea id="viewTextAreaID" rows="20" cols="80">Please wait while we fetch the json string...!</textarea>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="createModal" tabindex="-1" role="dialog" aria-labelledby="createModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="createModalLabel"> Place Holder </h4>
          </div>
          <div class="modal-body">
            <textarea id="createTextAreaID" rows="20" cols="80"></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="createProgramSheet()">Create</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="deleteModalLabel">Modal title</h4>
          </div>
          <div class="modal-body">
            Are you sure you want to delete this program sheet?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="deleteProgramSheet()">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      $(document).ready(function() {
        var substringMatcher = function() {
          return function findMatches(q, cb) {
            var strs = [];
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4) {
                  if (xhr.status === 200) {
                    var json_str = xhr.responseText;
                    var objs = jQuery.parseJSON(json_str);
                    for (var index in objs) {
                      var obj = objs[index];
                      for (var course_num in obj) {
                        ps_keys[course_num.toUpperCase()] = obj[course_num];
                        strs.push(course_num);
                      }
                    }
                  }
                  var matches, substringRegex;
               
                  // an array that will be populated with substring matches
                  matches = [];
               
                  // regex used to determine if a string contains the substring `q`
                  substrRegex = new RegExp(q, 'i');
               
                  // iterate through the pool of strings and for any string that
                  // contains the substring `q`, add it to the `matches` array
                  $.each(strs, function(i, str) {
                    if (substrRegex.test(str)) {
                      // the typeahead jQuery plugin expects suggestions to a
                      // JavaScript object, refer to typeahead docs for more info
                      matches.push({ value: str });
                    }
                  });
                  console.log(matches)
                  cb(matches);
                }
            }
            xhr.open("GET", "/api/programsheet/search?ps_name_prefix=" + q, true);
            xhr.send();
          };
        };
           
        $('#program-sheet .typeahead').typeahead({
          hint: true,
          highlight: true,
          minLength: 1
        },
        {
          name: 'program-sheet',
          displayKey: 'value',
          source: substringMatcher(),
          limit: 5
        });
      });


      $(document).ready(function() {
        var substringMatcher = function() {
          return function findMatches(q, cb) {
            var strs = [];
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4) {
                  if (xhr.status === 200) {
                    var json_str = xhr.responseText;
                    objs = jQuery.parseJSON(json_str);

                    for (var x in objs) {
                      var obj = objs[x];
                      for (var y in obj) {
                        course_keys[y.toUpperCase()] = obj[y];
                        strs.push(y);
                      }
                    }

                  }
                  var matches, substringRegex;
               
                  // an array that will be populated with substring matches
                  matches = [];
               
                  // regex used to determine if a string contains the substring `q`
                  substrRegex = new RegExp(q, 'i');
               
                  // iterate through the pool of strings and for any string that
                  // contains the substring `q`, add it to the `matches` array
                  $.each(strs, function(i, str) {
                    if (substrRegex.test(str)) {
                      // the typeahead jQuery plugin expects suggestions to a
                      // JavaScript object, refer to typeahead docs for more info
                      matches.push({ value: str });
                    }
                  });
                  console.log(matches)
                  cb(matches);
                }
            }
            xhr.open("GET", "/api/course/search/" + q, true);
            xhr.send();
          };
        };
           
        $('#course-list .typeahead').typeahead({
          hint: true,
          highlight: true,
          minLength: 1
        },
        {
          name: 'course-list',
          displayKey: 'value',
          source: substringMatcher(),
          limit: 5
        });
      });
    </script>

  </body>
</html>